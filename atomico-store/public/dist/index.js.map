{"version":3,"file":"index.js","sources":["../../node_modules/@atomico/core/module.js","../../node_modules/@atomico/router/module.js","../../node_modules/@atomico/base-element/module.js","../../node_modules/@atomico/element/module.js","../../src/reducer.js","../../src/components/atomico-store-header.js","../../src/components/atomico-store-button.js","../../src/components/atomico-store-card.js","../../src/index.js"],"sourcesContent":["/**\r\n * @typedef {(Object<string,any>)} VnodeProps;\r\n * @typedef {(Function|string)} VnodeType;\r\n * @typedef {{type:VnodeType,props:VnodeProps}} Vnode\r\n **/\r\n\r\n/**\r\n * @param {VnodeType} type\r\n * @param {VnodeProps} [props]\r\n * @param {Vnode|Vnode[]} [children]\r\n * @returns {Vnode}\r\n **/\r\nfunction createElement(type, props, children) {\r\n\tprops = props || {};\r\n\tif (arguments.length > 3) {\r\n\t\tchildren = [children];\r\n\t\tfor (let i = 3; i < arguments.length; i++) {\r\n\t\t\tchildren.push(arguments[i]);\r\n\t\t}\r\n\t}\r\n\tif (children != null) {\r\n\t\tprops.children = children;\r\n\t}\r\n\r\n\tlet vnode = { type, props },\r\n\t\tkey = props.key;\r\n\tif (key != null) {\r\n\t\tvnode.key = \"\" + key;\r\n\t}\r\n\t/**@type {Vnode} */\r\n\treturn vnode;\r\n}\r\n/**\r\n * Create or maintain a vnode, if this is boolean,\r\n * string or null returns a text type vnode\r\n * @param {(Vnode|string|null|boolean)} value\r\n * @returns {Vnode}\r\n **/\r\nfunction toVnode(value) {\r\n\tif (value == null || typeof value == \"boolean\") value = \"\";\r\n\r\n\tif (typeof value == \"string\" || typeof value == \"number\") {\r\n\t\treturn createElement(null, null, \"\" + value);\r\n\t}\r\n\r\n\treturn value;\r\n}\n\nconst ARRAY_EMPTY = [];\r\nconst EVENT_ALIAS = {};\r\nconst OBJECT_EMPTY = {};\r\nconst CONTEXT = \"@ctx.\";\r\n\r\nconst STATE = \"@state\";\r\nconst NODE_TYPE = \"@type\";\r\n\r\nconst NODE_HOST = \"host\";\r\n\r\nconst COMPONENT_CREATE = 0x61;\r\nconst COMPONENT_UPDATE = 0x74;\r\nconst COMPONENT_CREATED = 0x4f;\r\nconst COMPONENT_UPDATED = 0x4d;\r\nconst COMPONENT_CLEAR = 0x49;\r\nconst COMPONENT_REMOVE = 0x43;\r\n\r\nconst IGNORE = {\r\n\tchildren: 1\r\n};\r\n\r\nconst IGNORE_CHILDREN = {\r\n\tinnerHTML: 1,\r\n\ttextContent: 1,\r\n\tcontenteditable: 1\r\n};\r\n\r\nconst CSS_PROPS = {};\n\n/**\r\n * Return if value is array\r\n * @param {*}\r\n * @return {boolean}\r\n */\r\nfunction isArray(value) {\r\n\treturn Array.isArray(value);\r\n}\r\n/**\r\n * compare 2 array\r\n * @param {array} before\r\n * @param {array} after\r\n * @example\r\n * isEqualArray([1,2,3,4],[1,2,3,4]) // true\r\n * isEqualArray([1,2,3,4],[1,2,3])   // false\r\n * isEqualArray([5,1,2,3],[1,2,3,5]) // false\r\n * isEqualArray([],[]) // true\r\n * @returns {boolean}\r\n */\r\nfunction isEqualArray(before, after) {\r\n\tlet length = before.length;\r\n\tif (length !== after.length) return false;\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tif (before[i] !== after[i]) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction assign(master, commit) {\r\n\tfor (let key in commit) {\r\n\t\tmaster[key] = commit[key];\r\n\t}\r\n\tfor (let i = 2; i < arguments.length; i++) assign(master, arguments[i]);\r\n\treturn master;\r\n}\r\n\r\nlet defer = Promise.prototype.then.bind(Promise.resolve());\n\n/**\r\n *\r\n * @param {import(\"./render\").HTMLNode} node\r\n * @param {Object} props\r\n * @param {Object} nextProps\r\n * @param {boolean} isSvg\r\n * @param {Object} handlers\r\n * @param {any} [bindEvent]\r\n **/\r\nfunction diffProps(node, props, nextProps, isSvg, handlers, bindEvent) {\r\n\tprops = props || {};\r\n\r\n\tfor (let key in props) {\r\n\t\tif (IGNORE[key]) continue;\r\n\t\tif (!(key in nextProps)) {\r\n\t\t\tsetProperty(node, key, props[key], null, isSvg, handlers);\r\n\t\t}\r\n\t}\r\n\tlet ignoreChildren;\r\n\tfor (let key in nextProps) {\r\n\t\tif (IGNORE[key]) continue;\r\n\t\tsetProperty(\r\n\t\t\tnode,\r\n\t\t\tkey,\r\n\t\t\tprops[key],\r\n\t\t\tnextProps[key],\r\n\t\t\tisSvg,\r\n\t\t\thandlers,\r\n\t\t\tbindEvent\r\n\t\t);\r\n\t\tignoreChildren = ignoreChildren || IGNORE_CHILDREN[key];\r\n\t}\r\n\treturn ignoreChildren;\r\n}\r\n\r\nfunction setProperty(\r\n\tnode,\r\n\tkey,\r\n\tprevValue,\r\n\tnextValue,\r\n\tisSvg,\r\n\thandlers,\r\n\tbindEvent\r\n) {\r\n\tif ((key == \"checked\" || key == \"value\") && key in node) {\r\n\t\tprevValue = node[key];\r\n\t}\r\n\r\n\tif (nextValue == prevValue) return;\r\n\tif (\r\n\t\tkey[0] == \"o\" &&\r\n\t\tkey[1] == \"n\" &&\r\n\t\t(typeof nextValue == \"function\" || typeof prevValue == \"function\")\r\n\t) {\r\n\t\tsetEvent(node, key, nextValue, handlers, bindEvent);\r\n\t\treturn;\r\n\t}\r\n\r\n\tswitch (key) {\r\n\t\tcase \"ref\":\r\n\t\t\tif (nextValue) nextValue.current = node;\r\n\t\t\tbreak;\r\n\t\tcase \"style\":\r\n\t\t\tsetStyle(node, prevValue || node.style.cssText, nextValue);\r\n\t\t\tbreak;\r\n\t\tcase \"shadowDom\":\r\n\t\t\tif (\"attachShadow\" in node) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t(node.shadowRoot && !nextValue) ||\r\n\t\t\t\t\t(!node.shadowRoot && nextValue)\r\n\t\t\t\t) {\r\n\t\t\t\t\tnode.attachShadow({ mode: nextValue ? \"open\" : \"closed\" });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\tcase \"key\":\r\n\t\t\tkey = \"data-key\";\r\n\t\t\tif (nextValue == null) {\r\n\t\t\t\tdelete node.dataset.key;\r\n\t\t\t} else {\r\n\t\t\t\tnode.dataset.key = nextValue;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"class\":\r\n\t\tcase \"className\":\r\n\t\t\tkey = isSvg ? \"class\" : \"className\";\r\n\t\tdefault:\r\n\t\t\tif (key != \"list\" && !isSvg && key in node) {\r\n\t\t\t\tnode[key] = nextValue == null ? \"\" : nextValue;\r\n\t\t\t} else if (nextValue == null) {\r\n\t\t\t\tnode.removeAttribute(key);\r\n\t\t\t} else {\r\n\t\t\t\tnode.setAttribute(key, nextValue);\r\n\t\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n * @param {import(\"./render\").HTMLNode} node\r\n * @param {string} type\r\n * @param {function} [nextHandler]\r\n * @param {object} handlers\r\n */\r\nfunction setEvent(node, type, nextHandler, handlers, bindEvent) {\r\n\t// memorize the transformation\r\n\tif (!EVENT_ALIAS[type]) {\r\n\t\tEVENT_ALIAS[type] = type.slice(2).toLocaleLowerCase();\r\n\t}\r\n\t// get the name of the event to use\r\n\ttype = EVENT_ALIAS[type];\r\n\t// add handleEvent to handlers\r\n\tif (!handlers.handleEvent) {\r\n\t\t/**\r\n\t\t * {@link https://developer.mozilla.org/es/docs/Web/API/EventTarget/addEventListener#The_value_of_this_within_the_handler}\r\n\t\t **/\r\n\t\thandlers.handleEvent = event => handlers[event.type].call(bindEvent, event);\r\n\t}\r\n\tif (nextHandler) {\r\n\t\t// create the subscriber if it does not exist\r\n\t\tif (!handlers[type]) {\r\n\t\t\tnode.addEventListener(type, handlers);\r\n\t\t}\r\n\t\t// update the associated event\r\n\t\thandlers[type] = nextHandler;\r\n\t} else {\r\n\t\t// \tdelete the associated event\r\n\t\tif (handlers[type]) {\r\n\t\t\tnode.removeEventListener(type, handlers);\r\n\t\t\tdelete handlers[type];\r\n\t\t}\r\n\t}\r\n}\r\n/**\r\n * define style as string inline,this generates less mutation\r\n * to the sun and cleans the previously defined properties.\r\n * @param {import(\"./render\").HTMLNode} node\r\n * @param {(string|object)} prevValue\r\n * @param {(string|object)} nextValue\r\n */\r\nfunction setStyle(node, prevValue, nextValue) {\r\n\tlet prevCss = prevValue,\r\n\t\tnextCss = nextValue;\r\n\tif (typeof nextCss == \"object\") {\r\n\t\tnextCss = \"\";\r\n\t\tfor (let key in nextValue) {\r\n\t\t\tif (!nextValue[key]) continue;\r\n\t\t\t// memorizes the transformations associated with CSS properties\r\n\t\t\tif (!CSS_PROPS[key]) {\r\n\t\t\t\tCSS_PROPS[key] = key.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n\t\t\t}\r\n\t\t\tnextCss += `${CSS_PROPS[key]}:${nextValue[key]};`;\r\n\t\t}\r\n\t}\r\n\tif (prevCss != nextCss) {\r\n\t\tnode.style.cssText = nextCss;\r\n\t}\r\n}\n\n/**\r\n * @typedef {(HTMLElement|SVGElement|Text)} Element\r\n *\r\n * @typedef {import(\"./vnode\").Vnode} Vnode\r\n *\r\n * @typedef {Object<string,any>} Context\r\n *\r\n * @typedef {Function[]} Hooks\r\n *\r\n * @typedef {{prevent:boolean,context:Context,hooks:Hooks,next:Function,type:Function,props:import(\"./vnode\").VnodeProps}} ComponentSnap\r\n *\r\n * @typedef {{type:string}} Action\r\n *\r\n **/\r\n\r\n/**\r\n * @type {ComponentSnap}\r\n */\r\nlet CURRENT_COMPONENT;\r\n/**\r\n * @type {number}\r\n */\r\nlet CURRENT_COMPONENT_KEY_HOOK;\r\n/**\r\n * Returns the concurrent component running\r\n * @returns {ComponentSnap}\r\n */\r\nfunction getCurrentComponent() {\r\n\tif (!CURRENT_COMPONENT) {\r\n\t\tthrow new Error(\r\n\t\t\t\"the hooks can only be called from an existing functional component in the diff queue\"\r\n\t\t);\r\n\t}\r\n\treturn CURRENT_COMPONENT;\r\n}\r\n/**\r\n * Create or recover, the current state according to the global index\r\n * associated with the component\r\n * @param {(Function|null)} reducer\r\n * @param {*} state\r\n * @return {[*,(state:any,action:{type:any}]};\r\n */\r\nfunction useHook(reducer, state) {\r\n\tlet component = getCurrentComponent().component,\r\n\t\tindex = CURRENT_COMPONENT_KEY_HOOK++,\r\n\t\thook,\r\n\t\tisCreate;\r\n\tif (!component.hooks[index]) {\r\n\t\tisCreate = true;\r\n\t\tcomponent.hooks[index] = { state };\r\n\t}\r\n\thook = component.hooks[index];\r\n\thook.reducer = reducer;\r\n\tif (isCreate) dispatchHook(hook, { type: COMPONENT_CREATE });\r\n\treturn [hook.state, action => dispatchHook(hook, action)];\r\n}\r\n/**\r\n * dispatch the hook\r\n * @param {{reducer:(Function=),state}} hook\r\n * @param {Action} action\r\n */\r\nfunction dispatchHook(hook, action) {\r\n\tif (hook.reducer) {\r\n\t\thook.state = hook.reducer(hook.state, action);\r\n\t}\r\n}\r\n/**\r\n * dispatches the state of the components to the hooks subscribed to the component\r\n * @param {ComponentSnap[]} components\r\n * @param {Action} action\r\n */\r\nfunction dispatchComponents(components, action) {\r\n\tlet length = components.length;\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tlet component = components[i],\r\n\t\t\thooks = component.hooks,\r\n\t\t\thooksLength = hooks.length;\r\n\t\t// Mark the component as deleted\r\n\t\tif (action.type === COMPONENT_REMOVE) {\r\n\t\t\tcomponent.remove = true;\r\n\t\t}\r\n\t\tfor (let i = 0; i < hooksLength; i++) {\r\n\t\t\tdispatchHook(hooks[i], action);\r\n\t\t}\r\n\t}\r\n}\r\n/**\r\n * this function allows creating a block that analyzes the tag\r\n * defined as a function, in turn creates a global update scope for hook management.\r\n * @param {import(\"./render\").ConfigRender} config - name of space to store the components\r\n * @param {boolean} isSvg - inherit svg behavior\r\n */\r\nfunction createComponent(config, isSvg) {\r\n\t/**@type {ComponentSnap[]} */\r\n\tlet components = [];\r\n\t/**@type {Element} */\r\n\tlet host;\r\n\t/**\r\n\t * This function allows reducing the functional components based on\r\n\t * their return, in turn creates a unique state for each component\r\n\t * according to a depth index\r\n\t * @param {Vnode} vnode\r\n\t * @param {Context} context\r\n\t * @param {number} deep - incremental index that defines the position of the component in the store\r\n\t */\r\n\tfunction nextComponent(vnode, context, deep) {\r\n\t\t// if host does not exist as a node, the vnode is not reduced\r\n\t\tif (!host) return;\r\n\t\tvnode = toVnode(vnode);\r\n\t\t// if it is different from a functional node, it is sent to diff again\r\n\t\tif (typeof vnode.type != \"function\") {\r\n\t\t\tdispatchComponents(components.splice(deep), {\r\n\t\t\t\ttype: COMPONENT_REMOVE\r\n\t\t\t});\r\n\t\t\thost = diff(config, host, vnode, context, isSvg, updateComponent);\r\n\t\t\t// if the components no longer has a length, it is assumed that the updateComponent is no longer necessary\r\n\t\t\tif (components.length) host[config.id].updateComponent = updateComponent;\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t/**@type {ComponentSnap} */\r\n\t\tlet component = components[deep] || {};\r\n\t\t/**\r\n\t\t * @type {boolean} define whether the component is created or updated\r\n\t\t */\r\n\t\tlet isCreate;\r\n\t\t/**\r\n\t\t * @type {boolean} Define whether the component should continue with the update\r\n\t\t */\r\n\t\tlet withNext;\r\n\r\n\t\tif (component.type != vnode.type) {\r\n\t\t\t// the elimination is sent to the successors of the previous component\r\n\t\t\tdispatchComponents(components.splice(deep), {\r\n\t\t\t\ttype: COMPONENT_REMOVE\r\n\t\t\t});\r\n\t\t\t// stores the state of the component\r\n\t\t\tcomponents[deep] = assign({ hooks: [], context: {} }, vnode);\r\n\t\t\tisCreate = true;\r\n\t\t\twithNext = true;\r\n\t\t}\r\n\r\n\t\tcomponent = components[deep];\r\n\t\t/**@type {Vnode} */\r\n\t\tlet nextProps = vnode.props;\r\n\t\t/**@type {Vnode} */\r\n\t\tlet prevProps = component.props;\r\n\r\n\t\t// Compare previous props with current ones\r\n\t\tif (!withNext) {\r\n\t\t\tlet length = Object.keys(prevProps).length,\r\n\t\t\t\tnextLength = 0;\r\n\t\t\t// compare the lake of properties\r\n\t\t\tfor (let key in nextProps) {\r\n\t\t\t\tnextLength++;\r\n\t\t\t\tif (nextProps[key] != prevProps[key]) {\r\n\t\t\t\t\twithNext = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twithNext = withNext || length != nextLength;\r\n\t\t}\r\n\r\n\t\twithNext = component.context != context || withNext;\r\n\r\n\t\tcomponent.props = nextProps;\r\n\r\n\t\t// the current context is componentsd in the cache\r\n\t\tcomponent.context = context;\r\n\r\n\t\t/**\r\n\t\t * Create a snapshot of the current component\r\n\t\t */\r\n\t\tfunction next() {\r\n\t\t\tif (component.remove) return host;\r\n\r\n\t\t\tCURRENT_COMPONENT = {\r\n\t\t\t\tcomponent,\r\n\t\t\t\t/**\r\n\t\t\t\t * updates the status of the component, forcing the update of this\r\n\t\t\t\t */\r\n\t\t\t\tnext() {\r\n\t\t\t\t\tif (!component.prevent) {\r\n\t\t\t\t\t\tcomponent.prevent = true;\r\n\t\t\t\t\t\tdefer(() => {\r\n\t\t\t\t\t\t\tcomponent.prevent = false;\r\n\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tCURRENT_COMPONENT_KEY_HOOK = 0;\r\n\r\n\t\t\tdispatchComponents([component], { type: COMPONENT_UPDATE });\r\n\r\n\t\t\tlet vnextnode = component.type(component.props);\r\n\t\t\t// clean state constants\r\n\t\t\tCURRENT_COMPONENT = false;\r\n\t\t\tCURRENT_COMPONENT_KEY_HOOK = 0;\r\n\r\n\t\t\tnextComponent(vnextnode, component.context, deep + 1);\r\n\r\n\t\t\tdispatchComponents([component], {\r\n\t\t\t\ttype: isCreate ? COMPONENT_CREATED : COMPONENT_UPDATED\r\n\t\t\t});\r\n\r\n\t\t\tisCreate = false;\r\n\t\t}\r\n\t\tif (withNext && !component.prevent) next();\r\n\t}\r\n\t/**\r\n\t * allows to control HoCs and optimizes the executions\r\n\t * of the components with the memo pattern\r\n\t * @param {string} type - action to execute\r\n\t * @param {Element} nextHost\r\n\t * @param {Vnode} vnode\r\n\t * @param {Context} context\r\n\t * @returns {Element}\r\n\t */\r\n\tfunction updateComponent(type, nextHost, vnode, context) {\r\n\t\tswitch (type) {\r\n\t\t\tcase COMPONENT_UPDATE:\r\n\t\t\t\thost = nextHost;\r\n\t\t\t\tnextComponent(vnode, context, 0);\r\n\t\t\t\treturn host;\r\n\t\t\tcase COMPONENT_CLEAR:\r\n\t\t\t\tdispatchComponents([].concat(components).reverse(), { type });\r\n\t\t\t\tbreak;\r\n\t\t\tcase COMPONENT_REMOVE:\r\n\t\t\t\thost = false;\r\n\t\t\t\tdispatchComponents(components.reverse(), { type });\r\n\t\t\t\tcomponents = [];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn updateComponent;\r\n}\n\n/**\r\n *\r\n * @param {import(\"./render\").ConfigRender} config\r\n * @param {import(\"./render\").HTMLNode} node\r\n * @param {import(\"./vnode\").Vnode} nextVnode\r\n * @param {object} context\r\n * @param {boolean} isSvg\r\n * @param {Function} currentUpdateComponent\r\n * @return {import(\"./render\").HTMLNode}\r\n **/\r\nfunction diff(\r\n\tconfig,\r\n\tnode,\r\n\tnextVnode,\r\n\tcontext,\r\n\tisSvg,\r\n\tcurrentUpdateComponent\r\n) {\r\n\tlet { vnode, updateComponent, handlers = {} } =\r\n\t\t(node && node[config.id]) || {};\r\n\r\n\tif (vnode == nextVnode) return node;\r\n\r\n\tvnode = vnode || { props: {} };\r\n\r\n\tlet { type, props } = nextVnode,\r\n\t\t{ shadowDom, children } = props,\r\n\t\tisComponent = typeof type == \"function\";\r\n\r\n\tisSvg = isSvg || type == \"svg\";\r\n\tif (isComponent && !updateComponent) {\r\n\t\tupdateComponent = createComponent(config, isSvg);\r\n\t}\r\n\tif (!isComponent && type != NODE_HOST && getNodeName(node) !== type) {\r\n\t\tlet nextNode = createNode(type, isSvg),\r\n\t\t\tparent = node && node.parentNode;\r\n\r\n\t\tif (parent) {\r\n\t\t\tunmount(config, node, true, currentUpdateComponent);\r\n\t\t\tparent.replaceChild(nextNode, node);\r\n\t\t}\r\n\r\n\t\tnode = nextNode;\r\n\t\thandlers = {};\r\n\t}\r\n\tif (updateComponent && currentUpdateComponent != updateComponent) {\r\n\t\treturn updateComponent(COMPONENT_UPDATE, node, nextVnode, context);\r\n\t} else if (type == null) {\r\n\t\tif (node.nodeValue != children) {\r\n\t\t\tnode.nodeValue = children;\r\n\t\t}\r\n\t} else {\r\n\t\tlet ignoreChildren = diffProps(\r\n\t\t\tnode,\r\n\t\t\tvnode.props,\r\n\t\t\tnextVnode.props,\r\n\t\t\tisSvg,\r\n\t\t\thandlers,\r\n\t\t\tconfig.bind\r\n\t\t);\r\n\t\tif (!ignoreChildren && vnode.props.children != children) {\r\n\t\t\tdiffChildren(\r\n\t\t\t\tconfig,\r\n\t\t\t\tshadowDom ? node.shadowRoot || node : node,\r\n\t\t\t\tchildren,\r\n\t\t\t\tcontext,\r\n\t\t\t\tisSvg\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tnode[config.id] = { vnode: nextVnode, handlers };\r\n\treturn node;\r\n}\r\n/**\r\n *\r\n * @param {import(\"./render\").ConfigRender} config\r\n * @param {import(\"./render\").HTMLNode} parent\r\n * @param {import(\"./vnode\").Vnode[]} [nextChildren]\r\n * @param {Object} context\r\n * @param {boolean} isSvg\r\n */\r\nfunction diffChildren(config, parent, nextChildren, context, isSvg) {\r\n\tlet keyes = [],\r\n\t\tchildren = toList(nextChildren, false, keyes),\r\n\t\tchildrenLenght = children.length;\r\n\r\n\tlet childNodes = parent.childNodes,\r\n\t\tchildNodesKeyes = {},\r\n\t\tchildNodesLength = childNodes.length,\r\n\t\twithKeyes = keyes.withKeyes,\r\n\t\tindex = withKeyes\r\n\t\t\t? 0\r\n\t\t\t: childNodesLength > childrenLenght\r\n\t\t\t? childrenLenght\r\n\t\t\t: childNodesLength;\r\n\tfor (; index < childNodesLength; index++) {\r\n\t\tlet childNode = childNodes[index],\r\n\t\t\tkey = index;\r\n\t\tif (withKeyes) {\r\n\t\t\tkey = childNode.dataset.key;\r\n\t\t\tif (keyes.indexOf(key) > -1) {\r\n\t\t\t\tchildNodesKeyes[key] = childNode;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tunmount(config.id, childNode);\r\n\t\tindex--;\r\n\t\tchildNodesLength--;\r\n\t\tparent.removeChild(childNode);\r\n\t}\r\n\tfor (let i = 0; i < childrenLenght; i++) {\r\n\t\tlet child = children[i],\r\n\t\t\tindexChildNode = childNodes[i],\r\n\t\t\tnextSiblingChildNode = childNodes[i + 1],\r\n\t\t\tkey = withKeyes ? child.key : i,\r\n\t\t\tchildNode = withKeyes ? childNodesKeyes[key] : indexChildNode;\r\n\r\n\t\tif (withKeyes) {\r\n\t\t\tif (childNode != indexChildNode) {\r\n\t\t\t\tparent.insertBefore(childNode, indexChildNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet nextChildNode = diff(\r\n\t\t\tconfig,\r\n\t\t\t!childNode && typeof child.type == \"function\"\r\n\t\t\t\t? createNode(null)\r\n\t\t\t\t: childNode,\r\n\t\t\tchild,\r\n\t\t\tcontext,\r\n\t\t\tisSvg\r\n\t\t);\r\n\r\n\t\tif (!childNode) {\r\n\t\t\tif (nextSiblingChildNode) {\r\n\t\t\t\tparent.insertBefore(nextChildNode, nextSiblingChildNode);\r\n\t\t\t} else {\r\n\t\t\t\tparent.appendChild(nextChildNode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n/**\r\n * Remove the node and issue the deletion if it belongs to a component\r\n * @param {string} id\r\n * @param {import(\"./render\").HTMLNode} node\r\n * @param {boolean} clear\r\n * @param {function} currentUpdateComponent\r\n */\r\nfunction unmount(id, node, clear, currentUpdateComponent) {\r\n\tlet { updateComponent } = node[id] || {},\r\n\t\tchildNodes = node.childNodes,\r\n\t\tlength = childNodes.length;\r\n\tif (updateComponent && updateComponent != currentUpdateComponent) {\r\n\t\tupdateComponent(clear ? COMPONENT_CLEAR : COMPONENT_REMOVE);\r\n\t}\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tunmount(id, childNodes[i]);\r\n\t}\r\n}\r\n/**\r\n *\r\n * @param {string} type\r\n * @param {boolean} isSvg\r\n * @returns {import(\"./render\").HTMLNode}\r\n */\r\nfunction createNode(type, isSvg) {\r\n\tlet doc = document,\r\n\t\tnextNode;\r\n\tif (type != null) {\r\n\t\tnextNode = isSvg\r\n\t\t\t? doc.createElementNS(\"http://www.w3.org/2000/svg\", type)\r\n\t\t\t: doc.createElement(type);\r\n\t} else {\r\n\t\tnextNode = doc.createTextNode(\"\");\r\n\t}\r\n\tnextNode[NODE_TYPE] = type;\r\n\treturn nextNode;\r\n}\r\n\r\n/**\r\n * returns the localName of the node\r\n * @param {import(\"./render\").HTMLNode} node\r\n */\r\nfunction getNodeName(node) {\r\n\tif (!node) return;\r\n\t// store the process locally in the node to avoid transformation\r\n\tif (!node[NODE_TYPE]) {\r\n\t\tlet nodeName = node.nodeName.toLowerCase();\r\n\t\tnode[NODE_TYPE] = nodeName == \"#text\" ? null : nodeName;\r\n\t}\r\n\treturn node[NODE_TYPE];\r\n}\r\n/**\r\n * generates a flatmap of nodes\r\n * @param {?Array} children\r\n * @param {function} [map]\r\n * @param {string[]} keyes\r\n * @param {import(\"./vnode\").Vnode[]} list\r\n * @param {number} deep\r\n * @returns {import(\"./vnode\").Vnode[]}\r\n */\r\nfunction toList(children, map, keyes, list, deep = 0) {\r\n\tkeyes = keyes || [];\r\n\tlist = list || [];\r\n\r\n\tif (isArray(children)) {\r\n\t\tlet length = children.length;\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\ttoList(children[i], map, keyes, list, deep + 1);\r\n\t\t}\r\n\t} else {\r\n\t\tif (children == null && !deep) return ARRAY_EMPTY;\r\n\t\tlet vnode = map ? map(children, list.length) : toVnode(children);\r\n\t\tif (!map) {\r\n\t\t\tif (typeof vnode == \"object\") {\r\n\t\t\t\tif (vnode.key != null) {\r\n\t\t\t\t\tif (keyes.indexOf(vnode.key) == -1) {\r\n\t\t\t\t\t\tkeyes.push(vnode.key);\r\n\t\t\t\t\t\tkeyes.withKeyes = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlist.push(vnode);\r\n\t}\r\n\treturn list;\r\n}\n\n/**\r\n * @typedef {Object} ConfigRender\r\n * @property {string} id - namespace to store the state of the virtual-dom\r\n * @property {any} [bind] - Allows to bin events to a context this\r\n * @property {boolean} [host] - Allows a component to manipulate the main container\r\n **/\r\n\r\n/**\r\n * @typedef {(HTMLElement|SVGElement|Text)} HTMLNode\r\n **/\r\n\r\n/**\r\n *\r\n * @param {import(\"./vnode\").Vnode} vnode\r\n * @param {HTMLNode} parent\r\n * @param {Object} [options]\r\n **/\r\nfunction render(vnode, parent, options = OBJECT_EMPTY) {\r\n\t/**@type {ConfigRender}*/\r\n\tlet config = {\r\n\t\tid: options.id || STATE,\r\n\t\tbind: options.bind,\r\n\t\thost: options.host\r\n\t};\r\n\r\n\tvnode = toVnode(vnode);\r\n\r\n\tif (!config.host && vnode.type != NODE_HOST) {\r\n\t\tvnode = createElement(NODE_HOST, {}, vnode);\r\n\t}\r\n\r\n\tdiff(config, parent, vnode, OBJECT_EMPTY);\r\n}\n\nfunction useState(initialState) {\r\n\tlet next = getCurrentComponent().next,\r\n\t\ttype = 0x9f;\r\n\tlet [state, dispatch] = useHook((state, action) => {\r\n\t\tswitch (action.type) {\r\n\t\t\tcase COMPONENT_CREATE:\r\n\t\t\t\treturn typeof initialState == \"function\"\r\n\t\t\t\t\t? initialState()\r\n\t\t\t\t\t: initialState;\r\n\t\t\tcase type:\r\n\t\t\t\tlet nextState = action.state;\r\n\t\t\t\treturn typeof nextState == \"function\" ? nextState(state) : nextState;\r\n\t\t}\r\n\t\treturn state;\r\n\t});\r\n\treturn [\r\n\t\tstate,\r\n\t\tstate => {\r\n\t\t\tdispatch({ state, type });\r\n\t\t\tnext();\r\n\t\t}\r\n\t];\r\n}\r\n\r\nfunction useEffect(callback, args) {\r\n\tuseHook((state, action) => {\r\n\t\tswitch (action.type) {\r\n\t\t\tcase COMPONENT_CREATE:\r\n\t\t\t\treturn { args };\r\n\t\t\tcase COMPONENT_UPDATE:\r\n\t\t\tcase COMPONENT_REMOVE:\r\n\t\t\t\tif (state.clear) {\r\n\t\t\t\t\tlet next =\r\n\t\t\t\t\t\taction.type == COMPONENT_REMOVE ||\r\n\t\t\t\t\t\t(args && state.args ? !isEqualArray(args, state.args) : true);\r\n\t\t\t\t\tif (next) state.clear.then(handler => handler && handler());\r\n\t\t\t\t}\r\n\t\t\t\treturn assign({}, state, { args });\r\n\t\t\tcase COMPONENT_CREATED:\r\n\t\t\tcase COMPONENT_UPDATED:\r\n\t\t\t\tlet next =\r\n\t\t\t\t\t\taction.type == COMPONENT_CREATED ||\r\n\t\t\t\t\t\t(args && state.args ? !isEqualArray(args, state.args) : true),\r\n\t\t\t\t\tclear = state.clear;\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\tclear = defer(callback);\r\n\t\t\t\t}\r\n\t\t\t\treturn assign({}, state, { clear, args });\r\n\t\t}\r\n\t\treturn state;\r\n\t});\r\n}\r\n\r\nfunction useRef(current) {\r\n\tlet [ref] = useHook(false, {});\r\n\treturn ref;\r\n}\r\n\r\nfunction useMemo(callback, args) {\r\n\tlet [ref] = useHook(false, {});\r\n\tif (!ref.args) {\r\n\t\tref.value = callback();\r\n\t} else {\r\n\t\tif (!isEqualArray(ref.args, args)) {\r\n\t\t\tref.value = callback();\r\n\t\t}\r\n\t}\r\n\tref.args = args;\r\n\treturn ref.value;\r\n}\r\n\r\nfunction useReducer(reducer, initialState) {\r\n\tlet next = getCurrentComponent().next,\r\n\t\ttype = 0x9e;\r\n\tlet [state, dispatch] = useHook((state, action) => {\r\n\t\tswitch (action.type) {\r\n\t\t\tcase COMPONENT_CREATE:\r\n\t\t\t\treturn initialState;\r\n\t\t\tcase type:\r\n\t\t\t\treturn reducer(state, action.use);\r\n\t\t}\r\n\t\treturn state;\r\n\t});\r\n\treturn [\r\n\t\tstate,\r\n\t\tuse => {\r\n\t\t\tdispatch({ type, use });\r\n\t\t\tnext();\r\n\t\t}\r\n\t];\r\n}\n\n/**\r\n * @typedef {import(\"./vnode\").Vnode} Vnode\r\n */\r\n/**@type {number} */\r\nlet counter = 0;\r\n/**\r\n * @param {{id:string,defaultValue:any}}\r\n */\r\nfunction useContext({ id, defaultValue }) {\r\n\tlet component = getCurrentComponent().component;\r\n\treturn id in component.context ? component.context[id] : defaultValue;\r\n}\r\n/**\r\n * create a context object, which manipulates the context of the tree\r\n * @param {*} defaultValue\r\n */\r\nfunction createContext(defaultValue) {\r\n\tlet id = CONTEXT + counter++,\r\n\t\tContext = { Provider, Consumer, id, defaultValue };\r\n\t/**\r\n\t * create a new context for children\r\n\t * @param {{value:any,children:Vnode}}\r\n\t * @returns {Vnode}\r\n\t */\r\n\tfunction Provider({ value, children }) {\r\n\t\tlet { component } = getCurrentComponent();\r\n\t\tif (component.context[id] != value) {\r\n\t\t\tcomponent.context = assign({}, component.context, {\r\n\t\t\t\t[id]: value\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn children;\r\n\t}\r\n\t/**\r\n\t * Get the current context\r\n\t * @param {{children:Function}}\r\n\t * @returns {Vnode}\r\n\t */\r\n\tfunction Consumer({ children }) {\r\n\t\treturn children(useContext(Context));\r\n\t}\r\n\treturn Context;\r\n}\n\nlet h = createElement;\n\nexport { createContext, h, render, toList, useContext, useEffect, useMemo, useReducer, useRef, useState };\n","import {\r\n\tcreateContext,\r\n\tuseState,\r\n\tuseEffect,\r\n\tuseMemo,\r\n\tuseContext,\r\n\ttoList,\r\n\th\r\n} from \"@atomico/core\";\r\n\r\nlet FOLDERS = /([^\\/]+)/g;\r\nlet FOLDER = \"[^\\\\/]\";\r\nlet SPLIT = \"(?:\\\\/){0,1}\";\r\nlet PARAM = /^(:)(\\w+)(\\?|(\\.){3}){0,1}/;\r\nlet PARAMS_EMPTY = {};\r\nlet MEMO = {};\r\n\r\nfunction format(path) {\r\n\treturn path.replace(/(\\/){2,}/g, \"/\").replace(/([^\\/]+)\\/$/, \"$1\");\r\n}\r\n\r\nfunction parse(string) {\r\n\tlet folders = string.match(FOLDERS) || [\"\"];\r\n\tlet params = [];\r\n\tlet regexp = new RegExp(\r\n\t\t\"^\" +\r\n\t\t\tfolders\r\n\t\t\t\t.map(folder => {\r\n\t\t\t\t\tlet [string, param, field, type] = folder.match(PARAM) || [];\r\n\t\t\t\t\tif (param) {\r\n\t\t\t\t\t\tparams.push(field);\r\n\t\t\t\t\t\tif (type === \"...\") {\r\n\t\t\t\t\t\t\treturn `(.*)`;\r\n\t\t\t\t\t\t} else if (type === \"?\") {\r\n\t\t\t\t\t\t\treturn `${SPLIT}(${FOLDER}*)`;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn `\\\\/(${FOLDER}+)`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn `\\\\/(?:${folder\r\n\t\t\t\t\t\t\t.replace(/(\\.|\\-)/g, \"\\\\$1\")\r\n\t\t\t\t\t\t\t.replace(/\\*/g, FOLDER + \"+\")\r\n\t\t\t\t\t\t\t.replace(/\\((?!\\?\\:)/g, \"(?:\")})`;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.join(\"\") +\r\n\t\t\t\"$\",\r\n\t\t\"i\"\r\n\t);\r\n\r\n\treturn { regexp, params, logs: {} };\r\n}\r\n/**\r\n * permite comparar un patron de captura vs un ruta de entrada\r\n * @param {string} path - ruta de patron de captura\r\n * @param {string} value  - ruta de comparacion a patron\r\n * @return {array} - [ inRoute:boolean, params:object ];\r\n */\r\nfunction match(path, value) {\r\n\tpath = format(path);\r\n\tvalue = format(value);\r\n\tif (!MEMO[path]) {\r\n\t\tMEMO[path] = parse(path);\r\n\t}\r\n\tlet { regexp, params, logs } = MEMO[path];\r\n\tif (logs[value]) {\r\n\t\treturn logs[value];\r\n\t}\r\n\tlet vs = value.match(regexp);\r\n\treturn (logs[value] = [\r\n\t\tvs ? true : false,\r\n\t\tvs\r\n\t\t\t? vs.slice(1).reduce((next, value, index) => {\r\n\t\t\t\t\tnext[params[index] || index] = value;\r\n\t\t\t\t\treturn next;\r\n\t\t\t  }, {})\r\n\t\t\t: PARAMS_EMPTY\r\n\t]);\r\n}\r\n/**\r\n * Permite unificar 2 rutas\r\n * @param {*} a\r\n * @param {*} b\r\n */\r\nfunction resolve(a = \"\", b = \"\") {\r\n\treturn format(\r\n\t\ta.replace(/\\/(:[\\w]+...){0,1}$/, \"\") + \"/\" + b.replace(/^\\//, \"\")\r\n\t);\r\n}\r\n\r\n/**\r\n * Vnode prepare\r\n * @typedef {Object<string,any>} Props\r\n **/\r\n\r\n/**\r\n * @typedef {(Function|String)} Type\r\n */\r\n\r\n/**\r\n * @typedef {{type:Type,props:Props}} Vnode\r\n **/\r\n\r\n/**\r\n * @typedef {string} MatchPath - route pattern for parameter capture\r\n * @example\r\n * //  require\r\n * \"/folder\"\r\n * // param\r\n * \"/:folder\"\r\n * // optional\r\n * \"/:folder?\"\r\n * // rest param\r\n * \"/:folder...\"\r\n **/\r\n\r\n/**\r\n * @typedef {[boolean,Object<string,string>]} MatchReturn\r\n */\r\n\r\n/**\r\n * redirects the browser\r\n * @callback Redirect\r\n * @param {string} pathname\r\n * @return {void}\r\n **/\r\n\r\n/**\r\n * @namespace options\r\n * @property {Function} pathname\r\n **/\r\nlet options = {\r\n\t/**\r\n\t * @return {string} pathname\r\n\t */\r\n\tpathname() {\r\n\t\treturn location.pathname;\r\n\t},\r\n\t/**\r\n\t * Dispatch history a new pathname\r\n\t * @type {Redirect}\r\n\t */\r\n\tredirect(pathname) {\r\n\t\tif (pathname == options.pathname()) return;\r\n\t\thistory.pushState({}, \"history\", pathname);\r\n\t\twindow.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n\t},\r\n\tsetRootDefault(path) {\r\n\t\tRootPath.defaultValue = path;\r\n\t}\r\n};\r\n\r\n/**@type {{Provider:Function,Consumer:Function}} */\r\nlet ParentPath = createContext(\"/\");\r\n\r\nlet RootPath = createContext(\"\");\r\n/**\r\n * Crea una suscripcion al evento popstate del navegador\r\n * @returns {[string,Redirect]}\r\n */\r\nfunction useHistory() {\r\n\tlet pathname = options.pathname();\r\n\tlet [state, setState] = useState({ pathname });\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction handler() {\r\n\t\t\tlet pathname = options.pathname();\r\n\t\t\t// usa el estado como ref, para comparar el valor actual con el proximo, para asi forzar la update.\r\n\t\t\tif (state.pathname != pathname) {\r\n\t\t\t\tstate.pathname = pathname;\r\n\t\t\t\tsetState(state);\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener(\"popstate\", handler);\r\n\t\treturn () => window.removeEventListener(\"popstate\", handler);\r\n\t}, []);\r\n\treturn [pathname, options.redirect];\r\n}\r\n/**\r\n *\r\n * @param {MatchPath} path\r\n * @return {MatchReturn}\r\n */\r\nfunction useMatchRoute(path) {\r\n\tlet pathname = options.pathname();\r\n\tlet parentPath = useParentPath();\r\n\t// almacena el retorno del match, esto permite evitar update, si en concurrencia los valores no cambian.\r\n\treturn useMemo(() => [...match(resolve(parentPath, path), pathname)], [\r\n\t\tpath,\r\n\t\tpathname,\r\n\t\tparentPath\r\n\t]);\r\n}\r\n/**\r\n * @return {string}\r\n */\r\nfunction useParentPath() {\r\n\tlet parentPath = useContext(ParentPath);\r\n\tlet rootPath = useContext(RootPath);\r\n\treturn resolve(rootPath, parentPath);\r\n}\r\n/**\r\n * @type {Redirect}\r\n * @return {Function}\r\n */\r\nfunction useRedirect() {\r\n\tlet rootPath = useContext(RootPath);\r\n\treturn useMemo(\r\n\t\t() => path => {\r\n\t\t\toptions.redirect(resolve(rootPath, path));\r\n\t\t},\r\n\t\t[rootPath]\r\n\t);\r\n}\r\n/**\r\n *\r\n * @param {MatchPath} path\r\n * @return {MatchReturn}\r\n */\r\nfunction useRoute(path) {\r\n\tuseHistory();\r\n\treturn useMatchRoute(path);\r\n}\r\n/**\r\n *\r\n * @param {{children:Vnode[]}}\r\n * @returns {Vnode}\r\n */\r\nfunction Router({ children }) {\r\n\tlet [inRoute] = useRoute(\"/:pathname...\");\r\n\tlet pathname = options.pathname();\r\n\tlet parentPath = useParentPath();\r\n\r\n\tif (!inRoute) return;\r\n\r\n\tchildren = toList(children);\r\n\r\n\tfor (let i = 0; i < children.length; i++) {\r\n\t\tlet { type, props } = children[i];\r\n\t\tlet { path, ...nextProps } = props;\r\n\t\tlet value = resolve(parentPath, path);\r\n\t\tlet [inRoute, params] = match(value, pathname);\r\n\t\tif (inRoute) {\r\n\t\t\tnextProps.params = params;\r\n\t\t\treturn h(ParentPath.Provider, { value }, h(type, nextProps));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction Root({ children, path }) {\r\n\treturn h(RootPath.Provider, { value: path }, children);\r\n}\r\n\r\nexport {\r\n\toptions,\r\n\tuseHistory,\r\n\tuseMatchRoute,\r\n\tuseParentPath,\r\n\tuseRedirect,\r\n\tuseRoute,\r\n\tRouter,\r\n\tRoot\r\n};\r\n","/**\r\n * Applies JSON.parse to extract the real value of an attribute from a string.\r\n * @param {string} value\r\n * @returns {(boolean|string|number|Object|Array)}\r\n **/\r\nfunction parse(value) {\r\n\treturn JSON.parse(value);\r\n}\r\n\r\nexport default class Element extends HTMLElement {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t/**@type {Object<string,any>} */\r\n\t\tthis.props = {};\r\n\t\t/**@type {Promise} */\r\n\t\tthis.mounted = new Promise(resolve => (this.mount = resolve));\r\n\t\t/**@type {Promise} */\r\n\t\tthis.unmounted = new Promise(resolve => (this.unmount = resolve));\r\n\t}\r\n\tconnectedCallback() {\r\n\t\tthis.mount();\r\n\t}\r\n\tdisconnectedCallback() {\r\n\t\tthis.unmount();\r\n\t}\r\n\tattributeChangedCallback(name, oldValue, value) {\r\n\t\tif (oldValue == value) return;\r\n\t\tthis.setProperty(name, value);\r\n\t}\r\n\tstatic get observedAttributes() {\r\n\t\tlet observables = this.observables || {},\r\n\t\t\tattributes = [],\r\n\t\t\t/**\r\n\t\t\t * @param {string} - add the setter and getter to the constructor prototype\r\n\t\t\t */\r\n\t\t\tproxy = name => {\r\n\t\t\t\tObject.defineProperty(this.prototype, name, {\r\n\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\tthis.setProperty(name, value);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tget() {\r\n\t\t\t\t\t\treturn this.props[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\tfor (let key in observables) {\r\n\t\t\tlet attr = key.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n\t\t\tattributes.push(attr);\r\n\t\t\tif (!(name in this.prototype)) proxy(key);\r\n\t\t}\r\n\t\treturn attributes;\r\n\t}\r\n\t/**\r\n\t * validate to `value`, and then deliver it to the` update` method.\r\n\t * @param {name} name\r\n\t * @param {*} value\r\n\t */\r\n\tsetProperty(name, value) {\r\n\t\tname = name.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\r\n\t\tlet { observables } = this.constructor,\r\n\t\t\terror,\r\n\t\t\ttype = observables[name];\r\n\t\ttry {\r\n\t\t\tif (typeof value == \"string\") {\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase Boolean:\r\n\t\t\t\t\t\tvalue = parse(value || \"true\") == true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase Number:\r\n\t\t\t\t\t\tvalue = Number(value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase Object:\r\n\t\t\t\t\tcase Array:\r\n\t\t\t\t\t\tvalue = parse(value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase Function:\r\n\t\t\t\t\t\tvalue = window[value];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\terror = true;\r\n\t\t}\r\n\t\tif (!error && {}.toString.call(value) == `[object ${type.name}]`) {\r\n\t\t\tthis.update({ [name]: value });\r\n\t\t} else {\r\n\t\t\tthrow `the observable [${name}] must be of the type [${type.name}]`;\r\n\t\t}\r\n\t}\r\n}\r\n","import { render, h } from '@atomico/core';\nexport { h } from '@atomico/core';\nimport BaseElement from '@atomico/base-element';\n\nlet cache = {};\r\n\r\nlet ID = 0;\r\n\r\nclass Element extends BaseElement {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t/**@type {boolean} */\r\n\t\tlet prevent;\r\n\t\t/**\r\n\t\t * @namespace\r\n\t\t * @property {string} id - identifier to store the state of the virtual-dom\r\n\t\t * @property {HTMLElement} bind - allows bindear events defining as context the same customElement\r\n\t\t * @property {boolean} host - allows to enable control over the main container, in this case the customElement\r\n\t\t */\r\n\t\tlet options = {\r\n\t\t\tid: \"@wc.\" + ID++,\r\n\t\t\tbind: this,\r\n\t\t\thost: true\r\n\t\t};\r\n\t\t/**\r\n\t\t * add support {@link https://developer.mozilla.org/es/docs/Web/API/CSSStyleSheet}\r\n\t\t */\r\n\t\tlet { styles } = this.constructor;\r\n\t\tthis.render = this.render.bind(this);\r\n\t\t/**\r\n\t\t * @param {Object<string,any>} - Properties to update the component\r\n\t\t */\r\n\t\tthis.update = props => {\r\n\t\t\tthis.props = { ...this.props, ...props };\r\n\t\t\tif (!prevent) {\r\n\t\t\t\tprevent = true;\r\n\t\t\t\tthis.mounted.then(() => {\r\n\t\t\t\t\tprevent = false;\r\n\t\t\t\t\trender(h(this.render, this.props), this, options);\r\n\t\t\t\t\tif (styles && this.shadowRoot) {\r\n\t\t\t\t\t\tthis.shadowRoot.adoptedStyleSheets = styles;\r\n\t\t\t\t\t\tstyles = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.unmounted.then(() => render(\"\", this, options));\r\n\r\n\t\tthis.update();\r\n\t}\r\n}\r\n/**\r\n * @param {Function} component\r\n * @example\r\n * // define a functional component\r\n * function MyWc(props){}\r\n * // define the observables of the component\r\n * MyWc.observables = {value:String}\r\n * // when using the toClass function the functional component will be a class\r\n * customElements.define(\"my-wc\",createClass(MyWc));\r\n */\r\nfunction createClass(component) {\r\n\tlet CustomElement = class extends Element {};\r\n\tCustomElement.prototype.render = component;\r\n\tCustomElement.observables = component.observables;\r\n\tCustomElement.styles = component.styles;\r\n\treturn CustomElement;\r\n}\r\n/**\r\n * register the component, be it a class or function\r\n * @param {string} tagName\r\n * @param {Function} component\r\n * @return {Object} returns a jsx component\r\n */\r\nfunction customElement(tagName, component) {\r\n\tcustomElements.define(\r\n\t\ttagName,\r\n\t\tcomponent instanceof Element ? component : createClass(component)\r\n\t);\r\n\treturn props => h(tagName, props);\r\n}\r\n\r\nfunction css(string) {\r\n\tif (Array.isArray(string)) {\r\n\t\tlet args = arguments;\r\n\t\tstring = string\r\n\t\t\t.map((value, index) => value + (args[index + 1] || \"\"))\r\n\t\t\t.join(\"\");\r\n\t}\r\n\tif (!cache[string]) {\r\n\t\tcache[string] = new CSSStyleSheet();\r\n\t\tcache[string].replace(string);\r\n\t}\r\n\treturn cache[string];\r\n}\n\nexport { Element, createClass, css, customElement };\n","export let Actions = {\r\n\tADD_CART: Symbol(\"ADD_CART\"),\r\n\tREM_CART: Symbol(\"REM_CART\")\r\n};\r\n\r\nexport function reducer(state, { type, data }) {\r\n\tswitch (type) {\r\n\t\tcase Actions.ADD_CART:\r\n\t\t\tlet include;\r\n\t\t\tstate = state.map(product => {\r\n\t\t\t\tif (product.id == data.id) {\r\n\t\t\t\t\tinclude = true;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...product,\r\n\t\t\t\t\t\tcount: product.count + 1\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn product;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn include ? state : state.concat({ ...data, count: 1 });\r\n\t\tcase Actions.REM_CART:\r\n\t\t\treturn state\r\n\t\t\t\t.map(product =>\r\n\t\t\t\t\tproduct.id == data.id\r\n\t\t\t\t\t\t? { ...product, count: product.count - 1 }\r\n\t\t\t\t\t\t: product\r\n\t\t\t\t)\r\n\t\t\t\t.filter(product => product.count > 0);\r\n\t}\r\n}\r\n","import { h, customElement } from \"@atomico/element\";\r\n\r\nfunction Header() {\r\n\treturn (\r\n\t\t<host shadowDom>\r\n\t\t\t<style>\r\n\t\t\t\t{`\r\n\t\t\t\t\t:host {\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\tbackground: var(--theme-atomico-dark, black);\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tpadding: 0.75rem;\r\n\t\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\t}\r\n\t\t\t\t`}\r\n\t\t\t</style>\r\n\t\t\t<slot />\r\n\t\t</host>\r\n\t);\r\n}\r\n\r\nexport default customElement(\"atomico-store-header\", Header);\r\n","import { h, customElement } from \"@atomico/element\";\r\n\r\nfunction Button({ checked, counter }) {\r\n\treturn (\r\n\t\t<host shadowDom class={checked ? \"checked\" : \"\"}>\r\n\t\t\t<style>\r\n\t\t\t\t{`\r\n\t\t\t\t\t:host {\r\n\t\t\t\t\t\tpadding: 0.25rem 1rem;\r\n\t\t\t\t\t\tborder-radius: 5px;\r\n\t\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tbackground: var(--theme-atomico-dark, black);\r\n\t\t\t\t\t\tcolor: var(--theme-atomico-white, white);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t:host(.checked) {\r\n\t\t\t\t\t\tbackground: var(--theme-atomico-white, white);\r\n\t\t\t\t\t\tcolor: var(--theme-atomico-dark, black);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.counter {\r\n\t\t\t\t\t\twidth: 16px;\r\n\t\t\t\t\t\theight: 16px;\r\n\t\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\tfont-size: 10px;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\tmargin-left: 0.5rem;\r\n\t\t\t\t\t\tbackground: var(--theme-atomico-white, white);\r\n\t\t\t\t\t\tcolor: var(--theme-atomico-dark, black);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t:host(.checked) .counter {\r\n\t\t\t\t\t\tbackground: var(--theme-atomico-dark, black);\r\n\t\t\t\t\t\tcolor: var(--theme-atomico-white, white);\r\n\t\t\t\t\t}\r\n\t\t\t\t`}\r\n\t\t\t</style>\r\n\t\t\t<slot />\r\n\t\t\t{counter > 0 && <div class=\"counter\">{counter}</div>}\r\n\t\t</host>\r\n\t);\r\n}\r\n\r\nButton.observables = {\r\n\tchecked: Boolean,\r\n\tcounter: Number\r\n};\r\n\r\nexport default customElement(\"atomico-store-button\", Button);\r\n","import { h, customElement } from \"@atomico/element\";\r\n\r\nfunction Card({ labelButton }) {\r\n\treturn (\r\n\t\t<host shadowDom>\r\n\t\t\t<style>{`\r\n\t\t\t\t:host {\r\n\t\t\t\t\tflex: 0%;\r\n\t\t\t\t\tpadding: 1rem;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\tmargin: 1rem;\r\n\t\t\t\t\tbackground: white;\r\n\t\t\t\t\tborder-radius: 5px;\r\n\t\t\t\t\tbox-shadow: 0px 6px 12px rgba(0, 0, 0, 0.05);\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\tfont-size: 14px;\r\n\t\t\t\t}\r\n\t\t\t`}</style>\r\n\t\t\t<slot />\r\n\t\t</host>\r\n\t);\r\n}\r\n\r\nCard.observables = {\r\n\tlabelButton: String\r\n};\r\n\r\nexport default customElement(\"atomico-store-card\", Card);\r\n","import { useReducer } from \"@atomico/core\";\r\nimport { Router, useRedirect, useRoute, Root } from \"@atomico/router\";\r\nimport { h, customElement } from \"@atomico/element\";\r\nimport { reducer, Actions } from \"./reducer.js\";\r\nimport AtomicoStoreHeader from \"./components/atomico-store-header\";\r\nimport AtomicoStoreButton from \"./components/atomico-store-button\";\r\nimport Products from \"./pages/products\";\r\nimport Cart from \"./pages/cart\";\r\n\r\nfunction App({ products }) {\r\n\tlet [cart, dispatch] = useReducer(reducer, []);\r\n\tlet redirect = useRedirect();\r\n\tlet [inRoute, params] = useRoute(\"/:page/:any...\");\r\n\treturn (\r\n\t\t<host shadowDom>\r\n\t\t\t<style>\r\n\t\t\t\t{`\r\n\t\t\t\t\t\t:host {\r\n\t\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\t\t\tbackground: #f9fafc;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t`}\r\n\t\t\t</style>\r\n\t\t\t<AtomicoStoreHeader>\r\n\t\t\t\t<AtomicoStoreButton\r\n\t\t\t\t\tonClick={() => redirect(\"/\")}\r\n\t\t\t\t\tchecked={params.page == \"products\"}\r\n\t\t\t\t>\r\n\t\t\t\t\tProducts\r\n\t\t\t\t</AtomicoStoreButton>\r\n\t\t\t\t<AtomicoStoreButton\r\n\t\t\t\t\tcounter={cart.reduce((total, { count }) => total + count, 0)}\r\n\t\t\t\t\tonClick={() => redirect(\"/cart\")}\r\n\t\t\t\t\tchecked={params.page == \"cart\"}\r\n\t\t\t\t>\r\n\t\t\t\t\tCart\r\n\t\t\t\t</AtomicoStoreButton>\r\n\t\t\t</AtomicoStoreHeader>\r\n\t\t\t<Router>\r\n\t\t\t\t<Products\r\n\t\t\t\t\tpath=\"/\"\r\n\t\t\t\t\tproducts={products}\r\n\t\t\t\t\taddCart={data => {\r\n\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\ttype: Actions.ADD_CART,\r\n\t\t\t\t\t\t\tdata\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t\t<Cart\r\n\t\t\t\t\tpath=\"/cart\"\r\n\t\t\t\t\tproducts={cart}\r\n\t\t\t\t\tremCart={data => {\r\n\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\ttype: Actions.REM_CART,\r\n\t\t\t\t\t\t\tdata\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</Router>\r\n\t\t</host>\r\n\t);\r\n}\r\n\r\nfunction AtomicoStore({ products, location }) {\r\n\treturn (\r\n\t\t<Root path={location}>\r\n\t\t\t<App products={products} />\r\n\t\t</Root>\r\n\t);\r\n}\r\n\r\nAtomicoStore.observables = {\r\n\tproducts: Array,\r\n\tlocation: String\r\n};\r\n\r\ncustomElement(\"atomico-store\", AtomicoStore);\r\n"],"names":["createElement","type","props","children","arguments","length","i","push","vnode","key","toVnode","value","ARRAY_EMPTY","EVENT_ALIAS","OBJECT_EMPTY","CONTEXT","STATE","NODE_TYPE","NODE_HOST","COMPONENT_CREATE","COMPONENT_UPDATE","COMPONENT_CREATED","COMPONENT_UPDATED","COMPONENT_CLEAR","COMPONENT_REMOVE","IGNORE","IGNORE_CHILDREN","innerHTML","textContent","contenteditable","CSS_PROPS","isEqualArray","before","after","assign","master","commit","CURRENT_COMPONENT","CURRENT_COMPONENT_KEY_HOOK","defer","Promise","prototype","then","bind","resolve","setProperty","node","prevValue","nextValue","isSvg","handlers","bindEvent","current","prevCss","nextCss","replace","toLowerCase","style","cssText","setStyle","shadowRoot","attachShadow","mode","dataset","removeAttribute","setAttribute","nextHandler","slice","toLocaleLowerCase","handleEvent","event","call","addEventListener","removeEventListener","setEvent","getCurrentComponent","Error","useHook","reducer","state","hook","isCreate","component","index","hooks","dispatchHook","action","dispatchComponents","components","hooksLength","remove","createComponent","config","host","updateComponent","nextHost","context","nextComponent","deep","splice","diff","id","withNext","nextProps","prevProps","Object","keys","nextLength","prevent","next","[object Object]","vnextnode","concat","reverse","nextVnode","currentUpdateComponent","shadowDom","isComponent","nodeName","getNodeName","nextNode","createNode","parent","parentNode","unmount","replaceChild","nodeValue","ignoreChildren","diffProps","nextChildren","keyes","toList","childrenLenght","childNodes","childNodesKeyes","childNodesLength","withKeyes","childNode","indexOf","removeChild","child","indexChildNode","nextSiblingChildNode","insertBefore","nextChildNode","appendChild","diffChildren","clear","doc","document","createElementNS","createTextNode","map","list","Array","isArray","render","options","useMemo","callback","args","ref","counter","useContext","defaultValue","createContext","Context","Provider","Consumer","h","FOLDERS","FOLDER","SPLIT","PARAM","PARAMS_EMPTY","MEMO","format","path","match","string","folders","params","regexp","RegExp","folder","param","field","join","logs","parse","vs","reduce","a","b","pathname","location","history","pushState","window","dispatchEvent","PopStateEvent","RootPath","ParentPath","useHistory","setState","initialState","dispatch","nextState","useState","handler","redirect","useParentPath","parentPath","useRoute","useMatchRoute","Router","inRoute","Root","JSON","Element","HTMLElement","super","this","mounted","mount","unmounted","name","oldValue","observedAttributes","observables","attributes","proxy","defineProperty","attr","all","letter","toUpperCase","error","constructor","Boolean","Number","Function","e","toString","update","ID","BaseElement","styles","adoptedStyleSheets","customElement","tagName","customElements","define","CustomElement","createClass","Button","Card","use","rootPath","AtomicoStore"],"mappings":"AAYA,SAASA,EAAcC,EAAMC,EAAOC,GAEnC,GADAD,EAAQA,GAAS,GACbE,UAAUC,OAAS,EAAG,CACzBF,EAAW,CAACA,GACZ,IAAK,IAAIG,EAAI,EAAGA,EAAIF,UAAUC,OAAQC,IACrCH,EAASI,KAAKH,UAAUE,IAGV,MAAZH,IACHD,EAAMC,SAAWA,GAGlB,IAAIK,EAAQ,CAAEP,KAAAA,EAAMC,MAAAA,GACnBO,EAAMP,EAAMO,IAKb,OAJW,MAAPA,IACHD,EAAMC,IAAM,GAAKA,GAGXD,EAQR,SAASE,EAAQC,GAGhB,OAFa,MAATA,GAAiC,kBAATA,IAAoBA,EAAQ,IAEpC,iBAATA,GAAqC,iBAATA,EAC/BX,EAAc,KAAM,KAAM,GAAKW,GAGhCA,EAGR,MAAMC,EAAc,GACdC,EAAc,GACdC,EAAe,GACfC,EAAU,QAEVC,EAAQ,SACRC,EAAY,QAEZC,EAAY,OAEZC,EAAmB,GACnBC,EAAmB,IACnBC,EAAoB,GACpBC,EAAoB,GACpBC,EAAkB,GAClBC,EAAmB,GAEnBC,EAAS,CACdtB,SAAU,GAGLuB,EAAkB,CACvBC,UAAW,EACXC,YAAa,EACbC,gBAAiB,GAGZC,EAAY,GAqBlB,SAASC,EAAaC,EAAQC,GAC7B,IAAI5B,EAAS2B,EAAO3B,OACpB,GAAIA,IAAW4B,EAAM5B,OAAQ,OAAO,EACpC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQC,IAC3B,GAAI0B,EAAO1B,KAAO2B,EAAM3B,GAAI,OAAO,EAEpC,OAAO,EAGR,SAAS4B,EAAOC,EAAQC,GACvB,IAAK,IAAI3B,KAAO2B,EACfD,EAAO1B,GAAO2B,EAAO3B,GAEtB,IAAK,IAAIH,EAAI,EAAGA,EAAIF,UAAUC,OAAQC,IAAK4B,EAAOC,EAAQ/B,UAAUE,IACpE,OAAO6B,EAGR,IAmLIE,EAIAC,EAvLAC,EAAQC,QAAQC,UAAUC,KAAKC,KAAKH,QAAQI,WAqChD,SAASC,EACRC,EACArC,EACAsC,EACAC,EACAC,EACAC,EACAC,GAMA,IAJY,WAAP1C,GAA2B,SAAPA,IAAmBA,KAAOqC,IAClDC,EAAYD,EAAKrC,IAGduC,GAAaD,EACjB,GACW,KAAVtC,EAAI,IACM,KAAVA,EAAI,IACiB,mBAAbuC,GAA+C,mBAAbD,EAM3C,OAAQtC,GACP,IAAK,MACAuC,IAAWA,EAAUI,QAAUN,GACnC,MACD,IAAK,SA8EP,SAAkBA,EAAMC,EAAWC,GAClC,IAAIK,EAAUN,EACbO,EAAUN,EACX,GAAsB,iBAAXM,EAAqB,CAC/BA,EAAU,GACV,IAAK,IAAI7C,KAAOuC,EACVA,EAAUvC,KAEVqB,EAAUrB,KACdqB,EAAUrB,GAAOA,EAAI8C,QAAQ,WAAY,OAAOC,eAEjDF,MAAcxB,EAAUrB,MAAQuC,EAAUvC,OAGxC4C,GAAWC,IACdR,EAAKW,MAAMC,QAAUJ,GA5FpBK,CAASb,EAAMC,GAAaD,EAAKW,MAAMC,QAASV,GAChD,MACD,IAAK,YASJ,YARI,iBAAkBF,IAEnBA,EAAKc,aAAeZ,IACnBF,EAAKc,YAAcZ,IAErBF,EAAKe,aAAa,CAAEC,KAAMd,EAAY,OAAS,YAIlD,IAAK,MACJvC,EAAM,WACW,MAAbuC,SACIF,EAAKiB,QAAQtD,IAEpBqC,EAAKiB,QAAQtD,IAAMuC,EAEpB,MACD,IAAK,QACL,IAAK,YACJvC,EAAMwC,EAAQ,QAAU,YACzB,QACY,QAAPxC,IAAkBwC,GAASxC,KAAOqC,EACrCA,EAAKrC,GAAoB,MAAbuC,EAAoB,GAAKA,EACd,MAAbA,EACVF,EAAKkB,gBAAgBvD,GAErBqC,EAAKmB,aAAaxD,EAAKuC,QAY3B,SAAkBF,EAAM7C,EAAMiE,EAAahB,EAAUC,GAE/CtC,EAAYZ,KAChBY,EAAYZ,GAAQA,EAAKkE,MAAM,GAAGC,qBAGnCnE,EAAOY,EAAYZ,GAEdiD,EAASmB,cAIbnB,EAASmB,YAAcC,CAAAA,GAASpB,EAASoB,EAAMrE,MAAMsE,KAAKpB,EAAWmB,KAElEJ,GAEEhB,EAASjD,IACb6C,EAAK0B,iBAAiBvE,EAAMiD,GAG7BA,EAASjD,GAAQiE,GAGbhB,EAASjD,KACZ6C,EAAK2B,oBAAoBxE,EAAMiD,UACxBA,EAASjD,IA3EjByE,CAAS5B,EAAMrC,EAAKuC,EAAWE,EAAUC,GAoI3C,SAASwB,IACR,IAAKtC,EACJ,MAAM,IAAIuC,MACT,wFAGF,OAAOvC,EASR,SAASwC,EAAQC,EAASC,GACzB,IAECC,EACAC,EAHGC,EAAYP,IAAsBO,UACrCC,EAAQ7C,IAUT,OAPK4C,EAAUE,MAAMD,KACpBF,GAAW,EACXC,EAAUE,MAAMD,GAAS,CAAEJ,MAAAA,KAE5BC,EAAOE,EAAUE,MAAMD,IAClBL,QAAUA,EACXG,GAAUI,EAAaL,EAAM,CAAE/E,KAAMkB,IAClC,CAAC6D,EAAKD,MAAOO,GAAUD,EAAaL,EAAMM,IAOlD,SAASD,EAAaL,EAAMM,GACvBN,EAAKF,UACRE,EAAKD,MAAQC,EAAKF,QAAQE,EAAKD,MAAOO,IAQxC,SAASC,EAAmBC,EAAYF,GACvC,IAAIjF,EAASmF,EAAWnF,OACxB,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQC,IAAK,CAChC,IAAI4E,EAAYM,EAAWlF,GAC1B8E,EAAQF,EAAUE,MAClBK,EAAcL,EAAM/E,OAEjBiF,EAAOrF,OAASuB,IACnB0D,EAAUQ,QAAS,GAEpB,IAAK,IAAIpF,EAAI,EAAGA,EAAImF,EAAanF,IAChC+E,EAAaD,EAAM9E,GAAIgF,IAU1B,SAASK,EAAgBC,EAAQ3C,GAEhC,IAEI4C,EAFAL,EAAa,GA8HjB,SAASM,EAAgB7F,EAAM8F,EAAUvF,EAAOwF,GAC/C,OAAQ/F,GACP,KAAKmB,EAGJ,OAFAyE,EAAOE,EAtHV,SAASE,EAAczF,EAAOwF,EAASE,GAEtC,IAAKL,EAAM,OAGX,GAAyB,mBAFzBrF,EAAQE,EAAQF,IAECP,KAQhB,OAPAsF,EAAmBC,EAAWW,OAAOD,GAAO,CAC3CjG,KAAMuB,IAEPqE,EAAOO,EAAKR,EAAQC,EAAMrF,EAAOwF,EAAS/C,EAAO6C,QAE7CN,EAAWnF,SAAQwF,EAAKD,EAAOS,IAAIP,gBAAkBA,IAK1D,IAIIb,EAIAqB,EARApB,EAAYM,EAAWU,IAAS,GAUhChB,EAAUjF,MAAQO,EAAMP,OAE3BsF,EAAmBC,EAAWW,OAAOD,GAAO,CAC3CjG,KAAMuB,IAGPgE,EAAWU,GAAQhE,EAAO,CAAEkD,MAAO,GAAIY,QAAS,IAAMxF,GACtDyE,GAAW,EACXqB,GAAW,GAGZpB,EAAYM,EAAWU,GAEvB,IAAIK,EAAY/F,EAAMN,MAElBsG,EAAYtB,EAAUhF,MAG1B,IAAKoG,EAAU,CACd,IAAIjG,EAASoG,OAAOC,KAAKF,GAAWnG,OACnCsG,EAAa,EAEd,IAAK,IAAIlG,KAAO8F,EAEf,GADAI,IACIJ,EAAU9F,IAAQ+F,EAAU/F,GAAM,CACrC6F,GAAW,EACX,MAGFA,EAAWA,GAAYjG,GAAUsG,EAGlCL,EAAWpB,EAAUc,SAAWA,GAAWM,EAE3CpB,EAAUhF,MAAQqG,EAGlBrB,EAAUc,QAAUA,EAyChBM,IAAapB,EAAU0B,SApC3B,SAASC,IACR,GAAI3B,EAAUQ,OAAQ,OAAOG,EAE7BxD,EAAoB,CACnB6C,UAAAA,EAIA4B,OACM5B,EAAU0B,UACd1B,EAAU0B,SAAU,EACpBrE,EAAM,KACL2C,EAAU0B,SAAU,EACpBC,SAMJvE,EAA6B,EAE7BiD,EAAmB,CAACL,GAAY,CAAEjF,KAAMmB,IAExC,IAAI2F,EAAY7B,EAAUjF,KAAKiF,EAAUhF,OAEzCmC,GAAoB,EACpBC,EAA6B,EAE7B2D,EAAcc,EAAW7B,EAAUc,QAASE,EAAO,GAEnDX,EAAmB,CAACL,GAAY,CAC/BjF,KAAMgF,EAAW5D,EAAoBC,IAGtC2D,GAAW,EAEwB4B,GAelCZ,CAAczF,EAAOwF,EAAS,GACvBH,EACR,KAAKtE,EACJgE,EAAmB,GAAGyB,OAAOxB,GAAYyB,UAAW,CAAEhH,KAAAA,IACtD,MACD,KAAKuB,EACJqE,GAAO,EACPN,EAAmBC,EAAWyB,UAAW,CAAEhH,KAAAA,IAC3CuF,EAAa,IAKhB,OAAOM,EAaR,SAASM,EACRR,EACA9C,EACAoE,EACAlB,EACA/C,EACAkE,GAEA,IAAI3G,MAAEA,EAAKsF,gBAAEA,EAAe5C,SAAEA,EAAW,IACvCJ,GAAQA,EAAK8C,EAAOS,KAAQ,GAE9B,GAAI7F,GAAS0G,EAAW,OAAOpE,EAE/BtC,EAAQA,GAAS,CAAEN,MAAO,IAE1B,IAAID,KAAEA,EAAIC,MAAEA,GAAUgH,GACrBE,UAAEA,EAASjH,SAAEA,GAAaD,EAC1BmH,EAA6B,mBAARpH,EAMtB,GAJAgD,EAAQA,GAAiB,OAARhD,EACboH,IAAgBvB,IACnBA,EAAkBH,EAAgBC,EAAQ3C,KAEtCoE,GAAepH,GAAQiB,GAuJ7B,SAAqB4B,GACpB,IAAKA,EAAM,OAEX,IAAKA,EAAK7B,GAAY,CACrB,IAAIqG,EAAWxE,EAAKwE,SAAS9D,cAC7BV,EAAK7B,GAAyB,SAAZqG,EAAsB,KAAOA,EAEhD,OAAOxE,EAAK7B,GA9J6BsG,CAAYzE,KAAU7C,EAAM,CACpE,IAAIuH,EAAWC,EAAWxH,EAAMgD,GAC/ByE,EAAS5E,GAAQA,EAAK6E,WAEnBD,IACHE,EAAQhC,EAAQ9C,GAAM,EAAMqE,GAC5BO,EAAOG,aAAaL,EAAU1E,IAG/BA,EAAO0E,EACPtE,EAAW,GAEZ,GAAI4C,GAAmBqB,GAA0BrB,EAChD,OAAOA,EAAgB1E,EAAkB0B,EAAMoE,EAAWlB,GACpD,GAAY,MAAR/F,EACN6C,EAAKgF,WAAa3H,IACrB2C,EAAKgF,UAAY3H,OAEZ,EAzbR,SAAmB2C,EAAM5C,EAAOqG,EAAWtD,EAAOC,EAAUC,GAC3DjD,EAAQA,GAAS,GAEjB,IAAK,IAAIO,KAAOP,EACXuB,EAAOhB,IACLA,KAAO8F,GACZ1D,EAAYC,EAAMrC,EAAKP,EAAMO,GAAM,KAAMwC,EAAOC,GAGlD,IAAI6E,EACJ,IAAK,IAAItH,KAAO8F,EACX9E,EAAOhB,KACXoC,EACCC,EACArC,EACAP,EAAMO,GACN8F,EAAU9F,GACVwC,EACAC,EACAC,GAED4E,EAAiBA,GAAkBrG,EAAgBjB,IAEpD,OAAOsH,GAmaeC,CACpBlF,EACAtC,EAAMN,MACNgH,EAAUhH,MACV+C,EACAC,EACA0C,EAAOjD,OAEenC,EAAMN,MAAMC,UAAYA,GAqBjD,SAAsByF,EAAQ8B,EAAQO,EAAcjC,EAAS/C,GAC5D,IAAIiF,EAAQ,GACX/H,EAAWgI,EAAOF,GAAc,EAAOC,GACvCE,EAAiBjI,EAASE,OAEvBgI,EAAaX,EAAOW,WACvBC,EAAkB,GAClBC,EAAmBF,EAAWhI,OAC9BmI,EAAYN,EAAMM,UAClBrD,EAAQqD,EACL,EACAD,EAAmBH,EACnBA,EACAG,EACJ,KAAOpD,EAAQoD,EAAkBpD,IAAS,CACzC,IAAIsD,EAAYJ,EAAWlD,GAC1B1E,EAAM0E,EACHqD,IACH/H,EAAMgI,EAAU1E,QAAQtD,IACpByH,EAAMQ,QAAQjI,IAAQ,GACzB6H,EAAgB7H,GAAOgI,GAIzBb,EAAQhC,EAAOS,GAAIoC,GACnBtD,IACAoD,IACAb,EAAOiB,YAAYF,IAEpB,IAAK,IAAInI,EAAI,EAAGA,EAAI8H,EAAgB9H,IAAK,CACxC,IAAIsI,EAAQzI,EAASG,GACpBuI,EAAiBR,EAAW/H,GAC5BwI,EAAuBT,EAAW/H,EAAI,GACtCG,EAAM+H,EAAYI,EAAMnI,IAAMH,EAC9BmI,EAAYD,EAAYF,EAAgB7H,GAAOoI,EAE5CL,GACCC,GAAaI,GAChBnB,EAAOqB,aAAaN,EAAWI,GAIjC,IAAIG,EAAgB5C,EACnBR,EACC6C,GAAkC,mBAAdG,EAAM3I,KAExBwI,EADAhB,EAAW,MAEdmB,EACA5C,EACA/C,GAGIwF,IACAK,EACHpB,EAAOqB,aAAaC,EAAeF,GAEnCpB,EAAOuB,YAAYD,KA5EpBE,CACCtD,EACAwB,GAAYtE,EAAKc,YAAqBd,EACtC3C,EACA6F,EACA/C,GAKH,OADAH,EAAK8C,EAAOS,IAAM,CAAE7F,MAAO0G,EAAWhE,SAAAA,GAC/BJ,EA8ER,SAAS8E,EAAQvB,EAAIvD,EAAMqG,EAAOhC,GACjC,IAAIrB,gBAAEA,GAAoBhD,EAAKuD,IAAO,GACrCgC,EAAavF,EAAKuF,WAClBhI,EAASgI,EAAWhI,OACjByF,GAAmBA,GAAmBqB,GACzCrB,EAAgBqD,EAAQ5H,EAAkBC,GAE3C,IAAK,IAAIlB,EAAI,EAAGA,EAAID,EAAQC,IAC3BsH,EAAQvB,EAAIgC,EAAW/H,IASzB,SAASmH,EAAWxH,EAAMgD,GACzB,IACCuE,EADG4B,EAAMC,SAUV,OAPC7B,EADW,MAARvH,EACQgD,EACRmG,EAAIE,gBAAgB,6BAA8BrJ,GAClDmJ,EAAIpJ,cAAcC,GAEVmJ,EAAIG,eAAe,KAEtBtI,GAAahB,EACfuH,EAyBR,SAASW,EAAOhI,EAAUqJ,EAAKtB,EAAOuB,EAAMvD,EAAO,GAIlD,GAHAgC,EAAQA,GAAS,GACjBuB,EAAOA,GAAQ,GA5nBC9I,EA8nBJR,EA7nBLuJ,MAAMC,QAAQhJ,GA6nBE,CACtB,IAAIN,EAASF,EAASE,OACtB,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQC,IAC3B6H,EAAOhI,EAASG,GAAIkJ,EAAKtB,EAAOuB,EAAMvD,EAAO,OAExC,CACN,GAAgB,MAAZ/F,IAAqB+F,EAAM,OAAOtF,EACtC,IAAIJ,EAAQgJ,EAAMA,EAAIrJ,EAAUsJ,EAAKpJ,QAAUK,EAAQP,GAClDqJ,GACgB,iBAAThJ,GACO,MAAbA,EAAMC,MACwB,GAA7ByH,EAAMQ,QAAQlI,EAAMC,OACvByH,EAAM3H,KAAKC,EAAMC,KACjByH,EAAMM,WAAY,GAKtBiB,EAAKlJ,KAAKC,GAhpBZ,IAAiBG,EAkpBhB,OAAO8I,EAoBR,SAASG,EAAOpJ,EAAOkH,EAAQmC,EAAU/I,GAExC,IAAI8E,EAAS,CACZS,GAAIwD,EAAQxD,IAAMrF,EAClB2B,KAAMkH,EAAQlH,KACdkD,KAAMgE,EAAQhE,MAGfrF,EAAQE,EAAQF,GAEXoF,EAAOC,MAAQrF,EAAMP,MAAQiB,IACjCV,EAAQR,EAAckB,EAAW,GAAIV,IAGtC4F,EAAKR,EAAQ8B,EAAQlH,EAAOM,GA6D7B,SAASgJ,EAAQC,EAAUC,GAC1B,IAAKC,GAAOpF,GAAQ,EAAO,IAS3B,OARKoF,EAAID,MAGHjI,EAAakI,EAAID,KAAMA,KAF5BC,EAAItJ,MAAQoJ,KAMbE,EAAID,KAAOA,EACJC,EAAItJ,MA4BZ,IAAIuJ,EAAU,EAId,SAASC,GAAW9D,GAAEA,EAAE+D,aAAEA,IACzB,IAAIlF,EAAYP,IAAsBO,UACtC,OAAOmB,KAAMnB,EAAUc,QAAUd,EAAUc,QAAQK,GAAM+D,EAM1D,SAASC,EAAcD,GACtB,IAAI/D,EAAKtF,EAAUmJ,IAClBI,EAAU,CAAEC,SAMb,UAAkB5J,MAAEA,EAAKR,SAAEA,IAC1B,IAAI+E,UAAEA,GAAcP,IAChBO,EAAUc,QAAQK,IAAO1F,IAC5BuE,EAAUc,QAAU9D,EAAO,GAAIgD,EAAUc,QAAS,CACjDc,CAACT,GAAK1F,KAGR,OAAOR,GAbeqK,SAoBvB,UAAkBrK,SAAEA,IACnB,OAAOA,EAASgK,EAAWG,KArBKjE,GAAAA,EAAI+D,aAAAA,GAuBrC,OAAOE,EAGR,IAAIG,EAAIzK,ECv4BJ0K,EAAU,YACVC,EAAS,SACTC,EAAQ,eACRC,EAAQ,6BACRC,EAAe,GACfC,EAAO,GAEX,SAASC,EAAOC,GACf,OAAOA,EAAK1H,QAAQ,YAAa,KAAKA,QAAQ,cAAe,MAwC9D,SAAS2H,EAAMD,EAAMtK,GACpBsK,EAAOD,EAAOC,GACdtK,EAAQqK,EAAOrK,GACVoK,EAAKE,KACTF,EAAKE,GAzCP,SAAeE,GACd,IAAIC,EAAUD,EAAOD,MAAMR,IAAY,CAAC,IACpCW,EAAS,GA2Bb,MAAO,CAAEC,OA1BI,IAAIC,OAChB,IACCH,EACE5B,IAAIgC,IACJ,IAAKL,EAAQM,EAAOC,EAAOzL,GAAQuL,EAAON,MAAML,IAAU,GAC1D,OAAIY,GACHJ,EAAO9K,KAAKmL,GACC,QAATzL,EACI,OACY,MAATA,KACA2K,KAASD,aAELA,gBAGCa,EACdjI,QAAQ,WAAY,QACpBA,QAAQ,MAAOoH,EAAS,KACxBpH,QAAQ,cAAe,YAG1BoI,KAAK,IACP,IACD,KAGgBN,OAAAA,EAAQO,KAAM,IAYjBC,CAAMZ,IAEpB,IAAIK,OAAEA,EAAMD,OAAEA,EAAMO,KAAEA,GAASb,EAAKE,GACpC,GAAIW,EAAKjL,GACR,OAAOiL,EAAKjL,GAEb,IAAImL,EAAKnL,EAAMuK,MAAMI,GACrB,OAAQM,EAAKjL,GAAS,GACrBmL,EACAA,EACGA,EAAG3H,MAAM,GAAG4H,OAAO,CAAClF,EAAMlG,EAAOwE,KACjC0B,EAAKwE,EAAOlG,IAAUA,GAASxE,EACxBkG,GACJ,IACHiE,GAQL,SAASlI,EAAQoJ,EAAI,GAAIC,EAAI,IAC5B,OAAOjB,EACNgB,EAAEzI,QAAQ,sBAAuB,IAAM,IAAM0I,EAAE1I,QAAQ,MAAO,KA6ChE,IAAIsG,EAAU,CAIbqC,SAAQ,IACAC,SAASD,SAMjBpF,SAASoF,GACJA,GAAYrC,EAAQqC,aACxBE,QAAQC,UAAU,GAAI,UAAWH,GACjCI,OAAOC,cAAc,IAAIC,cAAc,eAExC1F,eAAemE,GACdwB,EAASrC,aAAea,IAKtByB,EAAarC,EAAc,KAE3BoC,EAAWpC,EAAc,IAK7B,SAASsC,IACR,IAAIT,EAAWrC,EAAQqC,YAClBnH,EAAO6H,GDumBb,SAAkBC,GACjB,IAAIhG,EAAOlC,IAAsBkC,MAE5B9B,EAAO+H,GAAYjI,EAAQ,CAACE,EAAOO,KACvC,OAAQA,EAAOrF,MACd,KAAKkB,EACJ,MAA8B,mBAAhB0L,EACXA,IACAA,EACJ,KAPM,IAQL,IAAIE,EAAYzH,EAAOP,MACvB,MAA2B,mBAAbgI,EAA0BA,EAAUhI,GAASgI,EAE7D,OAAOhI,IAER,MAAO,CACNA,EACAA,IACC+H,EAAS,CAAE/H,MAAAA,EAAO9E,KAhBZ,MAiBN4G,MC1nBsBmG,CAAS,CAAEd,SAAAA,ID+nBpC,IAAmBnC,EAAUC,ECjnB5B,ODinBkBD,EC7nBR,MACT,SAASkD,IACR,IAAIf,EAAWrC,EAAQqC,WAEnBnH,EAAMmH,UAAYA,IACrBnH,EAAMmH,SAAWA,EACjBU,EAAS7H,IAIX,OADAuH,OAAO9H,iBAAiB,WAAYyI,GAC7B,IAAMX,OAAO7H,oBAAoB,WAAYwI,KDmnBzBjD,EClnBzB,GDmnBHnF,EAAQ,CAACE,EAAOO,KACf,OAAQA,EAAOrF,MACd,KAAKkB,EACJ,MAAO,CAAE6I,KAAAA,GACV,KAAK5I,EACL,KAAKI,EAOJ,OANIuD,EAAMoE,QAER7D,EAAOrF,MAAQuB,IACdwI,IAAQjF,EAAMiF,OAAQjI,EAAaiI,EAAMjF,EAAMiF,QACvCjF,EAAMoE,MAAMzG,KAAKuK,GAAWA,GAAWA,KAE3C/K,EAAO,GAAI6C,EAAO,CAAEiF,KAAAA,IAC5B,KAAK3I,EACL,KAAKC,EACJ,IAAIuF,EACFvB,EAAOrF,MAAQoB,IACd2I,IAAQjF,EAAMiF,OAAQjI,EAAaiI,EAAMjF,EAAMiF,MACjDb,EAAQpE,EAAMoE,MAIf,OAHItC,IACHsC,EAAQ5G,EAAMwH,IAER7H,EAAO,GAAI6C,EAAO,CAAEoE,MAAAA,EAAOa,KAAAA,IAEpC,OAAOjF,IC1oBD,CAACmH,EAAUrC,EAAQqD,UAoB3B,SAASC,IACR,IAAIC,EAAajD,EAAWuC,GAE5B,OAAO9J,EADQuH,EAAWsC,GACDW,GAoB1B,SAASC,EAASpC,GAEjB,OADA0B,IArCD,SAAuB1B,GACtB,IAAIiB,EAAWrC,EAAQqC,WACnBkB,EAAaD,IAEjB,OAAOrD,EAAQ,IAAM,IAAIoB,EAAMtI,EAAQwK,EAAYnC,GAAOiB,IAAY,CACrEjB,EACAiB,EACAkB,IA+BME,CAAcrC,GAOtB,SAASsC,IAAOpN,SAAEA,IACjB,IAAKqN,GAAWH,EAAS,iBACrBnB,EAAWrC,EAAQqC,WACnBkB,EAAaD,IAEjB,GAAKK,EAAL,CAEArN,EAAWgI,EAAOhI,GAElB,IAAK,IAAIG,EAAI,EAAGA,EAAIH,EAASE,OAAQC,IAAK,CACzC,IAAIL,KAAEA,EAAIC,MAAEA,GAAUC,EAASG,IAC3B2K,KAAEA,KAAS1E,GAAcrG,EACzBS,EAAQiC,EAAQwK,EAAYnC,IAC3BuC,EAASnC,GAAUH,EAAMvK,EAAOuL,GACrC,GAAIsB,EAEH,OADAjH,EAAU8E,OAASA,EACZZ,EAAEiC,EAAWnC,SAAU,CAAE5J,MAAAA,GAAS8J,EAAExK,EAAMsG,MAKpD,SAASkH,IAAKtN,SAAEA,EAAQ8K,KAAEA,IACzB,OAAOR,EAAEgC,EAASlC,SAAU,CAAE5J,MAAOsK,GAAQ9K,GCrP9C,SAAS0L,GAAMlL,GACd,OAAO+M,KAAK7B,MAAMlL,GAGJ,MAAMgN,WAAgBC,YACpC9G,cACC+G,QAEAC,KAAK5N,MAAQ,GAEb4N,KAAKC,QAAU,IAAIvL,QAAQI,GAAYkL,KAAKE,MAAQpL,GAEpDkL,KAAKG,UAAY,IAAIzL,QAAQI,GAAYkL,KAAKlG,QAAUhF,GAEzDkE,oBACCgH,KAAKE,QAENlH,uBACCgH,KAAKlG,UAENd,yBAAyBoH,EAAMC,EAAUxN,GACpCwN,GAAYxN,GAChBmN,KAAKjL,YAAYqL,EAAMvN,GAExByN,gCACC,IAAIC,EAAcP,KAAKO,aAAe,GACrCC,EAAa,GAIbC,EAAQL,IACPzH,OAAO+H,eAAeV,KAAKrL,UAAWyL,EAAM,CAC3CpH,IAAInG,GACHmN,KAAKjL,YAAYqL,EAAMvN,IAExBmG,MACC,OAAOgH,KAAK5N,MAAMgO,OAItB,IAAK,IAAIzN,KAAO4N,EAAa,CAC5B,IAAII,EAAOhO,EAAI8C,QAAQ,WAAY,OAAOC,cAC1C8K,EAAW/N,KAAKkO,GACVP,QAAQJ,KAAKrL,WAAY8L,EAAM9N,GAEtC,OAAO6N,EAORxH,YAAYoH,EAAMvN,GACjBuN,EAAOA,EAAK3K,QAAQ,SAAU,CAACmL,EAAKC,IAAWA,EAAOC,eACtD,IACCC,GADGR,YAAEA,GAAgBP,KAAKgB,YAE1B7O,EAAOoO,EAAYH,GACpB,IACC,GAAoB,iBAATvN,EACV,OAAQV,GACP,KAAK8O,QACJpO,EAAkC,GAA1BkL,GAAMlL,GAAS,QACvB,MACD,KAAKqO,OACJrO,EAAQqO,OAAOrO,GACf,MACD,KAAK8F,OACL,KAAKiD,MACJ/I,EAAQkL,GAAMlL,GACd,MACD,KAAKsO,SACJtO,EAAQ2L,OAAO3L,IAIjB,MAAOuO,GACRL,GAAQ,EAET,GAAKA,GAAS,GAAGM,SAAS5K,KAAK5D,eAAqBV,EAAKiO,QAGxD,wBAAyBA,2BAA8BjO,EAAKiO,QAF5DJ,KAAKsB,OAAO,CAAEtI,CAACoH,GAAOvN,KC9EzB,IAAI0O,GAAK,EAET,MAAM1B,WAAgB2B,GACrBxI,cAGC,IAAIF,EAFJiH,QASA,IAAIhE,EAAU,CACbxD,GAAI,OAASgJ,KACb1M,KAAMmL,KACNjI,MAAM,IAKH0J,OAAEA,GAAWzB,KAAKgB,YACtBhB,KAAKlE,OAASkE,KAAKlE,OAAOjH,KAAKmL,MAI/BA,KAAKsB,OAASlP,CAAAA,IACb4N,KAAK5N,MAAQ,IAAK4N,KAAK5N,SAAUA,GAC5B0G,IACJA,GAAU,EACVkH,KAAKC,QAAQrL,KAAK,KACjBkE,GAAU,EACVgD,EAAOa,EAAEqD,KAAKlE,OAAQkE,KAAK5N,OAAQ4N,KAAMjE,GACrC0F,GAAUzB,KAAKlK,aAClBkK,KAAKlK,WAAW4L,mBAAqBD,EACrCA,EAAS,WAMbzB,KAAKG,UAAUvL,KAAK,IAAMkH,EAAO,GAAIkE,KAAMjE,IAE3CiE,KAAKsB,UA0BP,SAASK,GAAcC,EAASxK,GAK/B,OAJAyK,eAAeC,OACdF,EACAxK,aAAqByI,GAAUzI,EAhBjC,SAAqBA,GACpB,IAAI2K,EAAgB,cAAclC,KAIlC,OAHAkC,EAAcpN,UAAUmH,OAAS1E,EACjC2K,EAAcxB,YAAcnJ,EAAUmJ,YACtCwB,EAAcN,OAASrK,EAAUqK,OAC1BM,EAWqCC,CAAY5K,IAEjDhF,GAASuK,EAAEiF,EAASxP,oEC3E5B,uPCkBA,iCArBA,sXCAA,otCA6CA6P,gDAKA,qCClDA,qeAuBAC,oCAIA,wdCpBA,mCRu0BA,SAAoBlL,EAAS+H,GAC5B,IAAIhG,EAAOlC,IAAsBkC,MAE5B9B,EAAO+H,GAAYjI,EAAQ,CAACE,EAAOO,KACvC,OAAQA,EAAOrF,MACd,KAAKkB,EACJ,OAAO0L,EACR,KALM,IAML,OAAO/H,EAAQC,EAAOO,EAAO2K,KAE/B,OAAOlL,IAER,MAAO,CACNA,EACAkL,IACCnD,EAAS,CAAE7M,KAbL,IAaWgQ,IAAAA,IACjBpJ,gBCnpBH,WACC,IAAIqJ,EAAW/F,EAAWsC,GAC1B,OAAO3C,EACN,IAAMmB,IACLpB,EAAQqD,SAAStK,EAAQsN,EAAUjF,KAEpC,CAACiF,2kBOjJH,8EAQAC,gDAKAV"}